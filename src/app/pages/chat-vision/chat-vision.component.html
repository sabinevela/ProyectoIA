<section class="chat-container">
  <div class="header-decoration"></div>

  <header class="chat-header">
    <div class="header-content">
      <div class="bot-avatar">
        <div class="avatar-icon">ğŸ‘ï¸</div>
        <div class="status-indicator"></div>
      </div>
      <div class="header-text">
        <h1 class="bot-title">Food Vision</h1>
        <p class="bot-subtitle">Reconocimiento inteligente de comida</p>
      </div>
    </div>
  </header>

  <main class="chat-messages" #chatBox>
    <div class="welcome-message" *ngIf="messages.length === 0">
      <div class="welcome-icon">ğŸ”</div>
      <h3>Â¡Hola! Soy Food Vision</h3>
      <p>Sube una imagen de comida y te dirÃ© exactamente quÃ© es usando inteligencia artificial.</p>
    </div>

    <div *ngFor="let msg of messages; let i = index"
         class="message-wrapper"
         [class.user-message]="msg.user"
         [class.bot-message]="!msg.user">

      <div class="message" [class.animate-in]="i === messages.length - 1">
        
        <!-- Mensaje de texto -->
        <ng-container *ngIf="msg.type === 'text'">
          <div class="message-content" [class.analyzing]="msg.isAnalyzing">
            <div class="msg-text" [innerHTML]="formatMessage(msg.content)"></div>
            
            <!-- Spinner de anÃ¡lisis -->
            <div *ngIf="msg.isAnalyzing" class="analysis-spinner">
              <div class="spinner-dots">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- Mensaje de imagen -->
        <ng-container *ngIf="msg.type === 'image'">
          <div class="message-image-container">
            <img [src]="msg.content" alt="Imagen para anÃ¡lisis" class="msg-image" />
            <div class="image-overlay">
              <span class="image-label">ğŸ“¸ Imagen enviada</span>
            </div>
          </div>
        </ng-container>

        <div class="message-time">{{ getCurrentTime() }}</div>
      </div>
    </div>
  </main>

  <div class="chat-input-container">
    <div class="input-wrapper">
      
      <!-- BotÃ³n principal de subir imagen -->
      <div class="upload-section">
        <label for="imageUpload" class="upload-button main-upload" [class.disabled]="isAnalyzing">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21,15 16,10 5,21"/>
          </svg>
          <span>{{ isAnalyzing ? 'Analizando...' : 'Subir Imagen' }}</span>
        </label>
        <input 
          id="imageUpload" 
          type="file" 
          accept="image/*" 
          (change)="onImageUpload($event)" 
          [disabled]="isAnalyzing"
          hidden 
        />
      </div>
    </div>

    <!-- InformaciÃ³n de ayuda -->
    <div class="help-info">
      <div class="help-item">
        <span class="help-icon">ğŸ“±</span>
        <span class="help-text">Formatos: JPG, PNG, WebP</span>
      </div>
      <div class="help-item">
        <span class="help-icon">ğŸ“</span>
        <span class="help-text">MÃ¡ximo: 5MB</span>
      </div>
      <div class="help-item">
        <span class="help-icon">ğŸ¯</span>
        <span class="help-text">101 tipos de comida</span>
      </div>
    </div>
  </div>
</section>